<!DOCTYPE html>
<meta charset="utf-8">
<style>

.snippet {
    font-family: monospace;
    white-space: pre;
}

svg path.function.level-1 {
    fill-opacity: 0.03;
}

svg path.function:hover {
    fill-opacity: 0.2;
    stroke-dasharray: none;
}

svg path.function.level-1:hover {
    fill-opacity: 0.1;
}


</style>

<svg width="1600" height="100">
</svg>

<script src="//d3js.org/d3.v4.js"></script>
<script src="//d3js.org/d3-selection-multi.v1.min.js"></script>
<script src="tree.js"></script>
<script>

var svg = d3.select("svg"),
    width = +svg.attr("width"),
    height = +svg.attr("height"),
    g = svg.append("g").attr("transform", "translate(1000,0)");

var INPUT_FILE = "examples/" + ((window.location.search && window.location.search.substring(1)) || "d3_mercator.json"),
    NODE_HEIGHT = 45,
    NODE_WIDTH = 70,
    TREE_MARGIN = 100,
    FUNCTION_MARGIN = 4;


/*
var stratify = d3.stratify()
    .parentId(function(d) { return d.id.substring(0, d.id.lastIndexOf(".")); });
*/
d3.json(INPUT_FILE, function(error, treeData) {
  if (error) throw error;

  var yOffset = TREE_MARGIN;

  var maxWidth = 0;
  var lastRoot = null;

  g.selectAll(".tree")
    .data(treeData)
    .enter()
    .append("g")
    .attr("class", "tree")
    .each(function(d,i) {

        var g = d3.select(this);

        var root = drawTree(g, d, {
          nodeHeight: NODE_HEIGHT,
          nodeWidth: NODE_WIDTH,
          functionMargin: FUNCTION_MARGIN
        });

        if (lastRoot) {
          yOffset += TREE_MARGIN + compactDistance(lastRoot, root);
        }
        else {
          yOffset -= root.minY; // first tree - minY will be negative!
        }
        g.attr("transform","translate(0," + yOffset + ")");

        lastRoot = root;

    });
    if (lastRoot) {
      yOffset += TREE_MARGIN + lastRoot.maxY;
    }
    svg.attr('height', yOffset);
});

</script>

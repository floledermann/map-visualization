<!DOCTYPE html>
<meta charset="utf-8">
<style>

.node circle {
  fill: #999;
}

svg text {
    font-family: sans-serif;
    cursor: default;
    pointer-events: none;
  text-shadow: 0 1px 0 #fff, 0 -1px 0 #fff, 1px 0 0 #fff, -1px 0 0 #fff;
}

.node-internal circle {
  fill: #fff;
  stroke: #555;
  stroke-width: 1;
}

.node-internal text {
  text-shadow: 0 1px 0 #fff, 0 -1px 0 #fff, 1px 0 0 #fff, -1px 0 0 #fff;
}

.link {
  fill: none;
  stroke: #555;
  stroke-opacity: 0.4;
  stroke-width: 1.5px;
  pointer-events: none;
}

.snippet {
    font-family: monospace;
    white-space: pre;
}

svg path.function {
    fill: #000000;
    fill-opacity: 0.05;
    stroke: #000000;
    stroke-width: 0.9px;
    stroke-dasharray: 5 5;
}

svg path.function.level-1 {
    fill-opacity: 0.03;
}

svg path.function:hover {
    fill-opacity: 0.2;
    xstroke-width: 1.2px;
    stroke-dasharray: none;
}
svg path.function.level-1:hover {
    fill-opacity: 0.1;
}


</style>

<svg width="1600" height="8000">
</svg>

<script src="//d3js.org/d3.v4.js"></script>
<script src="tree.js"></script>
<script>

var svg = d3.select("svg"),
    width = +svg.attr("width"),
    height = +svg.attr("height"),
    g = svg.append("g").attr("transform", "translate(60,0)");

var INPUT_FILE = "examples/" + ((window.location.search && window.location.search.substring(1)) || "d3_mercator.json"),
    NODE_HEIGHT = 45,
    TREE_HEIGHT = 1300,
    MAX_DEPTH = 20,
    INITIAL_Y_OFFSET = 1500,
    FUNCTION_MARGIN = 4;

// ATTENTION width and height are swapped because we have a horizontal tree layout!
//var tree = d3.cluster().nodeSize([NODE_HEIGHT,1/MAX_DEPTH]);
var tree = d3.tree().nodeSize([NODE_HEIGHT,1/MAX_DEPTH]);

function x(x0) {
    return (1-x0) * (width - 180)
}
/*
var stratify = d3.stratify()
    .parentId(function(d) { return d.id.substring(0, d.id.lastIndexOf(".")); });
*/
d3.json(INPUT_FILE, function(error, treeData) {
  if (error) throw error;

  var yOffset = INITIAL_Y_OFFSET;

  g.selectAll(".tree")
    .data(treeData)
    .enter()
    .append("g")
    .attr("class", "tree")
    .each(function(d,i) {

        var g = d3.select(this);

        g.attr("transform","translate(0," + yOffset + ")");

        var root = d3.hierarchy(d, node => node.inputs);
        tree(root);

        yOffset += TREE_HEIGHT;

        drawTree(g, root, {
          nodeHeight: NODE_HEIGHT,
          functionMargin: FUNCTION_MARGIN
        });
    });
});

</script>
